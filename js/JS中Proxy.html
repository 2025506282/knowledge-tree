<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="app">
      <input type="text" id="input" />
      <div>您输入的是： <span id="title"></span></div>
      <button type="button" name="button" id="btn">添加到todolist</button>
      <ul id="list"></ul>
    </div>

    <script>
      let obj = {};
    //   let handle = {
    //     get(target, property) {
    //       console.log(`${property}被读取`);
    //       return property in target ? target[property] : 3;
    //     },
    //     set(target, property, value) {
    //       console.log(`${property}被设置为${value}`);
    //       target[property] = value;
    //     },
    //   };
    //   let p = new Proxy(obj, handle);
    //   p.name = "tome";
    //   p.age;
    //   p.password = [1, 2, 3, 4];
    //   p.password.push(5);
    //   console.log(p.password);
      const input = document.querySelector('#input');
      const title = document.querySelector('#title');
      const newObj = new Proxy(obj, {
          get: function(target, key, receiver) {
              console.log(`getting ${key}`);
              return Reflect.get(target, key, receiver);
          },
          set: function(target, key, value, receiver) {
              console.log('setting:',target, key, value, receiver);
              if(key === 'text') {
                  input.value = value;
                  title.innerHTML = value;
              }
              return Reflect.set(target, key, value, receiver);
          }
      })
      input.addEventListener('keyup', (e)=>{
          newObj.text = e.target.value;
      })
      const arr = [];
      const newArr = new Proxy(arr, {
          get: function(target, key, receiver) {
              return Reflect.get(target, key, receiver);
          },
          set: function(target, key, value, receiver) {
              console.log('set=>:', target, key, value, receiver);
              if(key !== 'length') {
                  Render.addList(value);
              }
              return Reflect.set(target, key, value, receiver);
          }
      })
      const Render = {
          // 初始化
          init: function(arr) {
              const fragment = document.createDocumentFragment();
              for(let i = 0; i < arr.length; i++) {
                  const li = document.createElement('li');
                  li.textContent = arr[i];
                  fragment.appendChild(li);
              }
          },
          addList: function(val) {
              const li = document.createElement('li');
              li.textContent = val;
              console.log('list=:', list);
              list.appendChild(li);
          } 
      }
      window.onload = function() {
          Render.init(arr);
      }
      btn.addEventListener('click',()=>{
          newArr.push(parseInt(newObj.text));
      })
    </script>
  </body>
</html>
